<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <!-- 設定字符集為 UTF-8，支援多種語言 -->
    <meta charset="UTF-8">
    <!-- 設定viewport，確保響應式設計在各種裝置上正常顯示 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 設定網頁標題 -->
    <title>Lacrymira.com</title>
    <!-- 網頁內嵌 CSS 樣式 -->
    <style>  scroll-snap-align: start;
}

/* 編輯器區按鈕樣式 */
.lacrymira-editor button {
  background: none;
  border: none;
  padding: 0px 15px;
  font-size: 12px;
  height: 25px;
  color: #404040;
  cursor: pointer;
  position: relative;
  line-height: 25px;
  z-index: 4;
  -webkit-tap-highlight-color: transparent;
  transition: color var(--transition-speed) ease;
}
.lacrymira-editor button:hover,
.lacrymira-editor button:focus {
  color: #5D4037;
}
.lacrymira-editor button:active,
.lacrymira-editor button.selected {
  color: #5D4037;
}

/* 遮罩層：用於遮住滾動區域未顯示部分 */
.lacrymira-mask {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--bg-color);
  z-index: 6;
  transition: width var(--transition-speed) ease;
}
.lacrymira-mask-left { left: 0; }
.lacrymira-mask-right { right: 1px; }

/* 內容展示區：展示按鈕點擊後的內容 */
#content-display {
  margin-top: 70px;
  padding: 20px;
  background: #fff;
  min-height: calc(100vh - 70px);
}
    </style>
  </head>
  <body>
    <!-- 頂部導航欄 -->
    <div class="lacrymira-header">
      <!-- 導航左側：Logo 與文字 -->
      <div class="lacrymira-header-left">
        <!-- Logo圖片 -->
        <img src="https://res.cloudinary.com/dfpnqmy7d/image/upload/f_auto,q_auto/jlvni3dcsnvopqn00nxo" alt="Logo">
        <!-- 文字部分：包含主標題與副標題 -->
        <div class="lacrymira-header-text">
          <div class="lacrymira-header-title">
            <span class="lacrymira-header-title-prefix">淺風 –&nbsp</span>
            <span class="lacrymira-header-title-main">吃枕頭中</span>
          </div>
          <div class="lacrymira-header-subtitle">
            <span class="lacrymira-header-subtitle-prefix">Lacrymira</span>
            <span class="lacrymira-header-subtitle-main"></span>
          </div>
        </div>
      </div>
      <!-- 左箭頭按鈕 -->
      <div class="lacrymira-arrow lacrymira-arrow-left">
        <span>◀</span>
      </div>
      <!-- 中間的多頁導航區 -->
      <div class="lacrymira-nav">
        <div class="lacrymira-nav-container">
          <ul>
            <!-- 每個<li>對應一個頁面，透過 data-page 屬性標識 -->
            <li class="lacrymira-nav-item" data-page="1" tabindex="0">第一頁</li>
            <li class="lacrymira-nav-item" data-page="2" tabindex="0">第二頁</li>
            <li class="lacrymira-nav-item" data-page="3" tabindex="0">第三頁</li>
          </ul>
          <!-- 藍色滑動條：顯示當前選中頁面的下劃線效果 -->
          <div class="blue-slider"></div>
        </div>
      </div>
      <!-- 右箭頭按鈕 -->
      <div class="lacrymira-arrow lacrymira-arrow-right">
        <span>▶</span>
      </div>
      <!-- 頂部右側按鈕（示例按鈕，內容為 @） -->
      <a href="#" class="lacrymira-header-btn"> @ </a>
    </div>

    <!-- lacrymira-editor：按鈕編輯器區 -->
    <div class="lacrymira-editor">
      <!-- 高亮背景：用於指示當前狀態，背景白色 -->
      <div class="lacrymira-highlight"></div>
      <!-- 藍色滑動條：按鈕下方顯示當前選中狀態 -->
      <div class="lacrymira-slider"></div>
      <!-- 多頁容器，包含不同頁面上的按鈕 -->
      <div class="lacrymira-pages">
        <!-- 第一頁 -->
        <div class="lacrymira-page" data-page="1">
          <button tabindex="0">歡迎光臨~</button>
          <button tabindex="0">w</button>
          <button tabindex="0">w</button>
          <button tabindex="0">w</button>
        </div>
        <!-- 第二頁 -->
        <div class="lacrymira-page" data-page="2">
          <button tabindex="0">w?</button>
          <button tabindex="0">w</button>
          <button tabindex="0">w</button>
          <button tabindex="0">w!</button>
        </div>
        <!-- 第三頁 -->
        <div class="lacrymira-page" data-page="3">
          <button tabindex="0">w</button>
          <button tabindex="0">網站構建中</button>
          <button tabindex="0">w</button>
        </div>
      </div>
      <!-- 左右遮罩，用於遮擋滾動區域未顯示部分 -->
      <div class="lacrymira-mask lacrymira-mask-left"></div>
      <div class="lacrymira-mask lacrymira-mask-right"></div>
    </div>

    <!-- 內容展示區：根據按鈕點擊顯示相應內容 -->
    <div id="content-display">
    </div>

    <!-- JavaScript交互邏輯 -->
    <script>
      // 取得頁面中主要的 DOM 元素
      const pages = document.querySelector('.lacrymira-pages');               // 多頁容器
      const maskLeft = document.querySelector('.lacrymira-mask-left');          // 左側遮罩
      const maskRight = document.querySelector('.lacrymira-mask-right');        // 右側遮罩
      const editor = document.querySelector('.lacrymira-editor');               // 按鈕編輯器區
      let activePage = null;       // 當前激活的頁面，初始為 null
      let clickScrolling = false;  // 標記點擊導航後是否正在滾動
      let centerTimeout;           // 用於控制中心定位的計時器

      /**
       * 更新高亮條位置與寬度
       * 根據 pages 的 scrollLeft 計算當前頁面與下一頁之間的插值，從而動態調整高亮條位置與寬度
       */
      function updateHighlightBar() {
        const scrollLeft = pages.scrollLeft;
        const pageWidth = pages.clientWidth;
        // 取得所有頁面按鈕區塊
        const pagesArray = document.querySelectorAll('.lacrymira-page');
        const totalPages = pagesArray.length;
        // 當前頁面索引：根據scrollLeft和頁面寬度計算
        const currentPageIndex = Math.floor(scrollLeft / pageWidth);
        // 下一頁索引（防止超出範圍）
        const nextPageIndex = Math.min(currentPageIndex + 1, totalPages - 1);
        const currentPage = pagesArray[currentPageIndex];
        const nextPage = pagesArray[nextPageIndex];
        if (currentPage && nextPage) {
          // 取得當前頁面所有按鈕，並計算總寬度
          const currentButtons = currentPage.querySelectorAll('button');
          const nextButtons = nextPage.querySelectorAll('button');
          let totalCurrentWidth = 0;
          currentButtons.forEach(button => { 
            totalCurrentWidth += button.getBoundingClientRect().width; 
          });
          let totalNextWidth = 0;
          nextButtons.forEach(button => { 
            totalNextWidth += button.getBoundingClientRect().width; 
          });
          // 計算插值，根據滾動進度決定兩個頁面的過渡狀態
          const interpolation = (scrollLeft % pageWidth) / pageWidth;
          // 插值計算後的寬度
          const interpolatedWidth = totalCurrentWidth + (totalNextWidth - totalCurrentWidth) * interpolation;
          document.querySelector('.lacrymira-highlight').style.width = `${interpolatedWidth}px`;

          // 取得每個頁面第一個按鈕的位置，作為高亮起始點參考
          const firstCurrentButton = currentButtons[0];
          const firstNextButton = nextButtons[0];
          const pagesRect = pages.getBoundingClientRect();
          const currentButtonLeft = firstCurrentButton.getBoundingClientRect().left - pagesRect.left;
          const nextButtonLeft = firstNextButton.getBoundingClientRect().left - pagesRect.left;
          // 插值計算後的左邊距
          const interpolatedLeft = currentButtonLeft + (nextButtonLeft - currentButtonLeft) * interpolation;
          document.querySelector('.lacrymira-highlight').style.left = `${interpolatedLeft}px`;

          // 根據高亮條位置與寬度調整遮罩層寬度，達到遮擋未選中部分的效果
          const containerWidth = editor.clientWidth;
          const leftMaskWidth = interpolatedLeft;
          const rightMaskWidth = Math.max(0, containerWidth - (interpolatedLeft + interpolatedWidth));
          maskLeft.style.width = `${leftMaskWidth}px`;
          maskRight.style.width = `${rightMaskWidth}px`;
        }
      }

      // 取得所有導航項目，並為它們添加點擊和鍵盤操作事件
      const navItems = document.querySelectorAll('.lacrymira-nav-item');
      navItems.forEach(item => {
        // 點擊事件：打開/切換編輯器及滾動到指定頁面
        item.addEventListener('click', function() {
          const page = this.getAttribute('data-page'); // 取得點擊項目所代表的頁碼
          clickScrolling = true; // 標記目前正在進行點擊滾動

          // 檢查編輯器是否已經展開
          if (!editor.classList.contains('open')) {
            // 如果未打開，則添加open類以展開編輯器
            editor.classList.add('open');
            activePage = page; // 設定激活頁面
            updateActiveNav(); // 更新導航項目的激活狀態
            scrollToPage(page); // 滾動至對應頁面
          } else {
            // 如果已打開
            if (activePage === page) {
              // 點擊相同頁面時，關閉編輯器
              editor.classList.remove('open');
              activePage = null;
              updateActiveNav();
            } else {
              // 點擊不同頁面則切換激活頁面並滾動
              activePage = page;
              updateActiveNav();
              scrollToPage(page);
            }
          }
          // 設置定時器，在1秒後結束點擊滾動標記
          setTimeout(() => { clickScrolling = false; }, 1000);
          // 延遲更新高亮條位置（與滾動動畫同步）
          setTimeout(updateHighlightBar, 700);
        });
        // 支持鍵盤 Enter 按鍵觸發點擊事件
        item.addEventListener('keydown', e => { if (e.key === 'Enter') item.click(); });
      });

      /**
       * 更新導航項目激活狀態
       * 根據 activePage 變數為相應項目添加或移除 active 樣式，
       * 同時更新藍色滑動條位置
       */
      function updateActiveNav() {
        navItems.forEach(item => {
          if (item.getAttribute('data-page') === activePage) { 
            item.classList.add('active'); 
          } else { 
            item.classList.remove('active'); 
          }
        });
        if (clickScrolling) { 
          // 若正在點擊滾動，延遲300ms更新藍色滑動條，避免動畫衝突
          setTimeout(updateBlueSlider, 300);
        } else { 
          updateBlueSlider();
        }
      }

      /**
       * 根據頁碼滾動至對應頁面
       * 使用 smooth 滾動行為實現動畫效果
       */
      function scrollToPage(page) {
        const pageIndex = parseInt(page, 10) - 1; // 轉換頁碼至索引（從0開始）
        const pageWidth = pages.clientWidth;
        pages.scrollTo({ left: pageIndex * pageWidth, behavior: 'smooth' });
      }

      /**
       * 根據頁面滾動更新激活的導航項目
       * 根據 scrollLeft 計算中間位置所在的頁面
       */
      function updateActivePageOnScroll() {
        const scrollLeft = pages.scrollLeft;
        const pageWidth = pages.clientWidth;
        // 根據頁面中間點判斷當前頁面
        const currentIndex = Math.floor((scrollLeft + pageWidth/2) / pageWidth);
        activePage = (currentIndex + 1).toString(); // 更新 activePage 為字符串格式
        updateActiveNav(); // 更新導航項目狀態
      }

      // 當頁面容器滾動時，通過requestAnimationFrame優化動畫效果
      pages.addEventListener('scroll', () => {
        requestAnimationFrame(() => {
          updateHighlightBar();
          if (editor.classList.contains('open')) {
            updateActivePageOnScroll();
            // 如果非點擊滾動，延遲定位激活項目到中央
            if (!clickScrolling) {
              clearTimeout(centerTimeout);
              centerTimeout = setTimeout(centerActivePage, 100);
            }
          }
        });
      });

      // 加載與窗口尺寸變化時更新高亮條位置
      window.addEventListener('load', updateHighlightBar);
      window.addEventListener('resize', updateHighlightBar);

      /**
       * 更新藍色滑動條的位置與寬度
       * 根據激活的導航項目在容器中的位置和寬度進行調整
       */
      function updateBlueSlider() {
        const activeItem = document.querySelector('.lacrymira-nav-item.active');
        const blueSlider = document.querySelector('.blue-slider');
        const navContainer = document.querySelector('.lacrymira-nav-container');
        if (activeItem && blueSlider && navContainer) {
          const itemRect = activeItem.getBoundingClientRect();
          const containerRect = navContainer.getBoundingClientRect();
          const extra = 8; // 額外補充寬度，使滑動條略大於按鈕
          const left = itemRect.left - containerRect.left - extra/2;
          const width = itemRect.width + extra;
          blueSlider.style.left = left + 'px';
          blueSlider.style.width = width + 'px';
        }
      }

      // 加載與調整視窗大小時更新藍色滑動條
      window.addEventListener('load', updateBlueSlider);
      window.addEventListener('resize', updateBlueSlider);

      /**
       * 將激活的導航項目置中
       */
      function centerActivePage() {
        const container = document.querySelector('.lacrymira-nav');
        const activeItem = container.querySelector('.lacrymira-nav-item.active');
        if (!activeItem) return;
        const containerCenter = container.clientWidth / 2;
        const activeCenter = activeItem.offsetLeft + activeItem.offsetWidth / 2;
        const desiredScrollLeft = activeCenter - containerCenter;
        container.scrollTo({ left: desiredScrollLeft, behavior: 'smooth' });
      }

      // 控制按鈕選中與滑動條動畫
      let currentButton = null;          // 當前激活的按鈕
      let highlightTransitioning = false; // 標記高亮過渡動畫狀態
      let queuedBtn = null;              // 暫存等待動畫結束後觸發的按鈕

      // 加載完成後為高亮元素添加過渡事件監聽
      window.addEventListener('load', () => {
        const highlight = document.querySelector('.lacrymira-highlight');
        if (highlight) {
          // 當過渡開始，標記動畫進行中
          highlight.addEventListener('transitionstart', () => { 
            highlightTransitioning = true; 
          });
          // 過渡結束後，若有排隊的按鈕則觸發點擊事件
          highlight.addEventListener('transitionend', () => {
            highlightTransitioning = false;
            if (queuedBtn) { 
              queuedBtn.click(); 
              queuedBtn = null; 
            }
          });
          // 防止動畫卡住，定時檢查動畫狀態
          setInterval(() => { 
            if (highlightTransitioning) { 
              highlightTransitioning = false; 
              if (queuedBtn) { 
                queuedBtn.click(); 
                queuedBtn = null; 
              } 
            }
          }, 400);
        }
      });

      // 為 lacrymira-editor 中的所有按鈕添加點擊事件
      document.querySelectorAll('.lacrymira-editor button').forEach(btn => {
        btn.addEventListener('click', function() {
          // 移除所有按鈕的選中樣式，再添加當前按鈕選中樣式
          document.querySelectorAll('.lacrymira-editor button').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          // 如果動畫正在過渡中，將點擊事件排隊等待動畫結束後觸發
          if (highlightTransitioning) {
            queuedBtn = this;
            setTimeout(() => { 
              if (!highlightTransitioning && queuedBtn) { 
                queuedBtn.click(); 
                queuedBtn = null; 
              } 
            }, 350);
            return;
          }
          // 更新當前按鈕並移動滑動條到該按鈕位置
          currentButton = this;
          moveSliderTo(this);
          updateContentDisplay(this);
        });
        // 支持鍵盤 Enter 按鍵觸發按鈕點擊
        btn.addEventListener('keydown', e => { if (e.key === 'Enter') btn.click(); });
      });

      // 當 pages 容器滾動時，如果有當前按鈕則調整滑動條位置
      document.querySelector('.lacrymira-pages').addEventListener('scroll', function(){
        if (currentButton) moveSliderTo(currentButton);
      });

      // 頁面加載完成後，自動點擊第一個按鈕
      window.addEventListener('load', () => {
        setTimeout(() => {
          const firstBtn = document.querySelector('.lacrymira-pages button');
          if (firstBtn) {
            currentButton = firstBtn;
            moveSliderTo(firstBtn);
            updateContentDisplay(firstBtn);
          }
        }, 200);
      });

      /**
       * 將滑動條移動到指定按鈕的位置，並調整其寬度
       * @param {HTMLElement} btn - 被點擊的按鈕元素
       */
      function moveSliderTo(btn) {
        const editorElem = document.querySelector('.lacrymira-editor');
        const slider = document.querySelector('.lacrymira-slider');
        const editorRect = editorElem.getBoundingClientRect();
        const btnRect = btn.getBoundingClientRect();
        const left = btnRect.left - editorRect.left; // 計算按鈕相對編輯器的左邊距
        const width = btnRect.width;                  // 按鈕寬度
        slider.style.left = left + 'px';
        slider.style.width = width + 'px';
      }

      /**
       * 根據按鈕的內文更新內容展示區
       * @param {HTMLElement} btn - 被點擊的按鈕元素
       */
      function updateContentDisplay(btn) {
        const contentArea = document.getElementById('content-display');
        if (!contentArea) return;
        let btnText = btn.innerText.trim(); // 取得按鈕文字，並去除前後空白
        let content = "";
        // 根據按鈕文字切換展示內容
        switch(btnText) {
          case "歡迎光臨~":
            content = "歡迎來到 Lacrymira！這裡是淺風自己建立的網站";
            break;
          case "w":
            content = "這是按鈕「w」所對應的內容。";
            break;
          case "w?":
            content = "這是按鈕「w?」所對應的內容。";
            break;
          case "w!":
            content = "這是按鈕「w!」所對應的內容。";
            break;
          case "網站構建中":
            content = "網站正在建構中";
            break;
          default:
            content = "你點擊了按鈕：" + btnText;
            break;
        }
        // 將內容放入展示區內
        contentArea.innerHTML = "<p>" + content + "</p>";
      }

      /**
       * 調整導航欄，確保內容居中顯示
       */
      function adjustNav() {
        const nav = document.querySelector('.lacrymira-nav');
        if (!nav) return;
        const ul = nav.querySelector('ul');
        if (!ul) return;
        // 清除先前設定的 margin
        ul.style.marginLeft = '';
        ul.style.marginRight = '';
        nav.style.overflowX = 'auto';
        const contentWidth = ul.scrollWidth;
        const navRect = nav.getBoundingClientRect();
        // 如果導航內容寬度小於視窗寬度，則居中顯示
        if (contentWidth < window.innerWidth) {
          const computedMargin = window.innerWidth / 2 - navRect.left - contentWidth / 2;
          if (computedMargin > 0) {
            ul.style.marginLeft = computedMargin + 'px';
            nav.style.overflowX = 'hidden';
          }
        }
        // 調整左右箭頭的顯示
        adjustArrows();
      }

      /**
       * 根據當前滾動位置調整左右箭頭的透明度
       */
      function adjustArrows() {
        const nav = document.querySelector('.lacrymira-nav');
        const leftArrow = document.querySelector('.lacrymira-arrow-left');
        const rightArrow = document.querySelector('.lacrymira-arrow-right');
        if (!nav || !leftArrow || !rightArrow) return;
        const scrollLeft = nav.scrollLeft;
        const maxScrollLeft = nav.scrollWidth - nav.clientWidth;
        // 如果沒有滾動空間，則隱藏左右箭頭
        if (maxScrollLeft <= 0) {
          leftArrow.style.opacity = 0;
          rightArrow.style.opacity = 0;
        } else {
          // 左箭頭：在最左側時隱藏；右箭頭：在最右側時隱藏
          leftArrow.style.opacity = scrollLeft <= 0 ? 0 : 1;
          rightArrow.style.opacity = scrollLeft >= maxScrollLeft ? 0 : 1;
        }
      }

      // 當導航欄滾動時，調用 adjustArrows 更新箭頭狀態
      document.querySelector('.lacrymira-nav').addEventListener('scroll', adjustArrows);
      // 網頁加載與尺寸變化後調整導航
      window.addEventListener('load', () => { setTimeout(adjustNav, 100); });
      window.addEventListener('resize', () => { setTimeout(adjustNav, 100); });
    </script>
  </body>
</html>
